<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Hand Neon Particles - 20 Shapes</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
#ui{
 position:absolute;top:15px;left:15px;color:white;
 font-size:13px;line-height:1.4
}
#videoBox{
 position:absolute;bottom:15px;right:15px;
 width:150px;height:110px;border:2px solid #444;
 border-radius:8px;overflow:hidden;transform:scaleX(-1)
}
video{width:100%;height:100%;object-fit:cover}
</style>
</head>
<body>

<div id="ui">
<b>AI Hand Neon System</b><br>
<span id="shapeText">Shape: SPHERE</span><br>
<span id="neonText">Neon: ON</span><br>
<span id="perfText"></span><br><br>
‚úä Fist ‚Üí Attract<br>
ü§è Pinch ‚Üí Change Shape<br>
‚úã Palm ‚Üí Neon ON<br>
‚úåÔ∏è Two Fingers ‚Üí Neon OFF
</div>

<div id="videoBox">
<video id="video"></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
// ===== DEVICE & PERFORMANCE =====
const isMobile=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const perfText = document.getElementById("perfText");
perfText.innerText=isMobile?"MODE: MOBILE":"MODE: DESKTOP";

// ===== CONFIG =====
const COUNT=isMobile?3000:9000;
let currentShape="sphere";
let neon=true;
let lastSwitch=0;
let isFist=false;
let audioLevel=0;

// ===== AI SMOOTHING =====
let smoothX=0, smoothY=0;
const SMOOTH=isMobile?0.12:0.18;
let fistHold=0;

// ===== THREE.JS SETUP =====
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.z=18;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,isMobile?1:2));
document.body.appendChild(renderer.domElement);

// ===== PARTICLES =====
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
const col=new Float32Array(COUNT*3);

// ===== SHAPE POSITIONS =====
function shapePos(i){
 const t = i / COUNT;
 const phi = Math.acos(1 - 2 * t);
 const theta = Math.PI * (1 + Math.sqrt(5)) * i;

 switch(currentShape){
  case "heart": { const a=t*Math.PI*2; return {x:4*Math.pow(Math.sin(a),3),y:3*Math.cos(a)-1.5*Math.cos(2*a),z:0}; }
  case "spiral": return {x:Math.cos(theta)*t*12,y:Math.sin(theta)*t*12,z:(t-0.5)*15};
  case "wave": return {x:(t-0.5)*20,y:Math.sin(i*0.15)*3,z:0};
  case "star": const r=5+2*Math.sin(5*theta); return {x:r*Math.cos(theta),y:r*Math.sin(theta),z:(t-0.5)*10};
  case "cone": const angle=t*Math.PI*2; return {x:t*7*Math.cos(angle),y:t*7,z:t*7*Math.sin(angle)};
  case "cylinder": const a=t*Math.PI*2; return {x:5*Math.cos(a),y:(t-0.5)*10,z:5*Math.sin(a)};
  case "torus": const r1=6; const r2=1.5; return {x:(r1+r2*Math.cos(6*theta))*Math.cos(theta), y:r2*Math.sin(6*theta), z:(r1+r2*Math.cos(6*theta))*Math.sin(theta)};
  case "diamond": return {x:6*Math.sin(phi)*Math.cos(theta),y:6*Math.sin(phi)*Math.sin(theta),z:Math.abs(6*Math.cos(phi))};
  case "cross": return {x: (i%2? -5:5), y: (i/COUNT-0.5)*10, z: (i%3-1)*3};
  case "cresent": return {x:5*Math.cos(theta)+2,y:5*Math.sin(theta),z:(t-0.5)*5};
  case "cube": const c=6*(t-0.5); return {x:c*Math.sin(theta),y:c*Math.cos(theta),z:c};
  case "pyramid": const s=t*6; return {x:s*Math.cos(theta),y:s, z:s*Math.sin(theta)};
  case "flower": return {x:Math.sin(6*theta)*5,y:Math.sin(i*0.2)*3,z:Math.cos(6*theta)*5};
  case "hexagon": const h=5; return {x:h*Math.cos(6*theta),y:(t-0.5)*8,z:h*Math.sin(6*theta)};
  case "pentagon": const p=5; return {x:p*Math.cos(5*theta),y:(t-0.5)*7,z:p*Math.sin(5*theta)};
  case "doubleSpiral": return {x:Math.cos(2*theta)*t*12,y:Math.sin(2*theta)*t*12,z:(t-0.5)*10};
  case "zigzag": return {x:(i/COUNT-0.5)*15,y:Math.sin(i*0.5)*5,z:Math.cos(i*0.5)*5};
  case "sphere2": const phi2=Math.acos(1-2*t); return {x:8*Math.sin(phi2)*Math.cos(theta),y:8*Math.sin(phi2)*Math.sin(theta),z:8*Math.cos(phi2)};
  case "ellipsoid": return {x:7*Math.sin(phi)*Math.cos(theta),y:5*Math.sin(phi)*Math.sin(theta),z:10*Math.cos(phi)};
  default: return {x:7*Math.sin(phi)*Math.cos(theta),y:7*Math.sin(phi)*Math.sin(theta),z:7*Math.cos(phi)};
 }
}

// Initialize particles
for(let i=0;i<COUNT;i++){
 const p=shapePos(i);
 pos[i*3]=p.x; pos[i*3+1]=p.y; pos[i*3+2]=p.z;
 col[i*3]=0.2; col[i*3+1]=0.7; col[i*3+2]=1;
}

geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
geo.setAttribute("color",new THREE.BufferAttribute(col,3));

const mat=new THREE.PointsMaterial({
 size:isMobile?.1:.08,
 vertexColors:true,
 transparent:true,
 depthWrite:false,
 blending:THREE.AdditiveBlending
});

const points=new THREE.Points(geo, mat);
scene.add(points);

// ===== AUDIO =====
const AC=window.AudioContext||window.webkitAudioContext;
const ctx=new AC();
const analyser=ctx.createAnalyser();
analyser.fftSize=isMobile?128:256;
const data=new Uint8Array(analyser.frequencyBinCount);

navigator.mediaDevices.getUserMedia({audio:true})
.then(s=>ctx.createMediaStreamSource(s).connect(analyser));
addEventListener("click",()=>ctx.resume(),{once:true});

// ===== HAND TRACKING =====
const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({
 maxNumHands:1,
 modelComplexity:isMobile?0:1,
 minDetectionConfidence:.6,
 minTrackingConfidence:.6
});

let handX=0, handY=0;
hands.onResults(r=>{
 if(!r.multiHandLandmarks) return;
 const l = r.multiHandLandmarks[0];

 const rawX=(.5-l[8].x)*30;
 const rawY=(.5-l[8].y)*20;

 smoothX+=(rawX-smoothX)*SMOOTH;
 smoothY+=(rawY-smoothY)*SMOOTH;
 handX=smoothX;
 handY=smoothY;

 const pinch=Math.hypot(l[4].x-l[8].x,l[4].y-l[8].y)<0.05;
 const fist=Math.hypot(l[8].x-l[5].x,l[8].y-l[5].y)<0.12;
 const tips=[8,12,16,20];
 const openPalm=tips.every(i=>l[i].y<l[0].y+0.25);
 const twoFingers=Math.abs(l[12].y-l[8].y)>0.05;

 if(fist) fistHold++; else fistHold=0;
 const FIST_HOLD=isMobile?2:3;
 isFist=fistHold>FIST_HOLD;

 if(pinch && Date.now()-lastSwitch>1000){
  const shapes=["sphere","heart","spiral","wave","star","cone","cylinder","torus","diamond","cross","cresent","cube","pyramid","flower","hexagon","pentagon","doubleSpiral","zigzag","sphere2","ellipsoid"];
  currentShape=shapes[(shapes.indexOf(currentShape)+1)%shapes.length];
  document.getElementById("shapeText").innerText="Shape: "+currentShape.toUpperCase();
  lastSwitch=Date.now();
 }

 if(openPalm) neon=true;
 if(twoFingers) neon=false;
});

// ===== CAMERA =====
const video=document.getElementById("video");
new Camera(video,{onFrame:()=>hands.send({image:video}),width:640,height:480}).start();

// ===== ANIMATION =====
function animate(){
 requestAnimationFrame(animate);

 analyser.getByteFrequencyData(data);
 audioLevel=data.reduce((a,b)=>a+b)/data.length/255;

 mat.blending=neon?THREE.AdditiveBlending:THREE.NormalBlending;
 mat.size=(isMobile?.1:.08)*(neon?1.4+audioLevel:1);
 document.getElementById("neonText").innerText=neon?"Neon: ON":"Neon: OFF";

 const p=geo.attributes.position.array;
 for(let i=0;i<COUNT;i++){
  const id=i*3;
  const t=shapePos(i);
  if(isFist){
   p[id]+=(handX-p[id])*0.08;
   p[id+1]+=(handY-p[id+1])*0.08;
  }else{
   p[id]+=(t.x-p[id])*0.04;
   p[id+1]+=(t.y-p[id+1])*0.04;
   p[id+2]+=(t.z-p[id+2])*0.04;
  }
 }

 geo.attributes.position.needsUpdate=true;
 points.rotation.y+=(isMobile?.0.002:0.004)*(0.5+audioLevel);
 renderer.render(scene,camera);
}
animate();

// ===== RESIZE =====
addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>